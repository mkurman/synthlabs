version: '3.8'

services:
  cockroachdb:
    image: cockroachdb/cockroach:latest-v24.1
    command: start-single-node --insecure --store=attrs=ssd,path=/cockroach/cockroach-data
    ports:
      - "26257:26257"
      - "8080:8080"
    volumes:
      - cockroach-data:/cockroach/cockroach-data
    environment:
      - COCKROACH_DATABASE=synthlabs

  init:
    image: cockroachdb/cockroach:latest-v24.1
    entrypoint: /bin/bash
    command: >
      -c "
      sleep 5 &&
      cockroach sql --insecure --host=cockroachdb:26257 --execute='CREATE DATABASE IF NOT EXISTS synthlabs;'
      "
    depends_on:
      - cockroachdb

volumes:
  cockroach-data:
